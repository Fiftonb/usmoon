## 项目国际化架构设计总结

### 1. 核心技术栈
- **框架**: Next.js (支持内置 i18n 路由)
- **国际化库**: 自定义实现 + `@formatjs/intl-localematcher` + `negotiator`
- **类型安全**: 完整的 TypeScript 类型定义

### 2. 支持的语言
项目支持 **8 种语言**：
- `en` - English (默认语言)
- `zh` - 简体中文  
- `zh-tw` - 繁體中文
- `de` - Deutsch (德语)
- `ru` - Русский (俄语)
- `ja` - 日本語 (日语)
- `fr` - Français (法语)
- `ko` - 한국어 (韩语)

### 3. 架构组件

#### 3.1 配置层 (`next.config.js`)
```javascript
i18n: {
  locales: ['en', 'zh', 'zh-tw', 'de', 'ru', 'ja', 'fr', 'ko'],
  defaultLocale: 'en',
}
```

#### 3.2 中间件层 (`src/middleware.ts`)
- **智能语言检测**: 
  - 优先检查 Cookie 中存储的 `NEXT_LOCALE`
  - 通过 `Accept-Language` 头部自动检测用户语言偏好
  - 使用 `negotiator` 库解析浏览器语言优先级
- **语言映射**: 将浏览器语言代码映射到项目支持的语言
  ```typescript
  const languageMap = {
    "zh-tw": "zh-tw", "zh-HK": "zh-tw", "zh-MO": "zh-tw",
    "zh-CN": "zh", "zh-SG": "zh"
  }
  ```
- **自动重定向**: 为路径添加语言前缀并设置 Cookie

#### 3.3 翻译系统 (`src/lib/i18n.ts`)
- **类型安全的翻译**: 使用 TypeScript 递归类型生成所有翻译键的类型
- **嵌套键支持**: 支持 `"whois_fields.name"` 形式的点分割键
- **变量插值**: 支持 `{{variable}}` 模板语法
- **回退机制**: 如果当前语言缺少翻译，自动回退到英文

```typescript
export function useTranslation() {
  const { t, locale } = useTranslation();
  // t("whois_fields.name") 
  // t("toast.copy_failed", { message: "error" })
}
```

#### 3.4 翻译文件结构 (`locales/`)
- **统一结构**: 所有语言文件使用相同的 JSON 结构
- **分类组织**: 按功能域分组（如 `whois_fields`、`toast` 等）
- **嵌套对象**: 支持多层级的翻译组织

### 4. 用户体验特性

#### 4.1 语言切换器 (`src/components/language-switcher.tsx`)
- **下拉菜单**: 提供直观的语言选择界面
- **本地化名称**: 使用各语言的原生名称显示
- **状态持久化**: 选择后保存到 Cookie (1年有效期)
- **即时切换**: 无需刷新页面即可切换语言

#### 4.2 智能语言检测
- **Cookie 优先级**: 用户手动选择的语言优先
- **浏览器检测**: 自动检测浏览器语言偏好
- **区域映射**: 智能映射相似的语言变体

### 5. 文档国际化
`docs/` 目录包含多语言版本的 README：
- `README_CN.md` (简体中文)
- `README_TW.md` (繁体中文)  
- `README_DE.md` (德语)
- `README_FR.md` (法语)
- `README_JP.md` (日语)
- `README_KR.md` (韩语)
- `README_RU.md` (俄语)

### 6. 架构优势

1. **类型安全**: 编译时检查翻译键的正确性
2. **性能优化**: 静态导入翻译文件，支持 Tree Shaking
3. **用户体验**: 自动语言检测 + 手动切换选项
4. **维护友好**: 统一的文件结构，易于添加新语言
5. **SEO 友好**: 使用 Next.js 原生 i18n 路由支持
6. **渐进增强**: 即使 JavaScript 失败，基本的语言路由仍然工作

### 7. 扩展性设计
- **易于添加新语言**: 只需添加翻译文件并更新配置
- **插值支持**: 支持动态内容的本地化
- **组件化**: 翻译逻辑封装在 Hook 中，易于复用

这个架构设计体现了现代 Web 应用国际化的最佳实践，在保证类型安全的同时提供了优秀的用户体验和开发体验。
